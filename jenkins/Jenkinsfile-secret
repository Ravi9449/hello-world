properties([
    parameters([
        [$class: 'StringParameterDefinition',
            name: 'Check-secret Username',
            description: 'Username for check-secret',
            defaultValue: getDefaultValue(),
        ]
    ])
])

def getDefaultValue() {
    def secretData = [:]

    try {
        def kubectlCmd = "kubectl get secret check-secret -o json"
        def kubectlOutput = sh(script: kubectlCmd, returnStatus: true).trim()
        
        if (kubectlOutput == 0) {
            def secretJson = sh(script: kubectlCmd, returnStdout: true).trim()
            def json = new groovy.json.JsonSlurper().parseText(secretJson)
            secretData = json.data
            def username = new String(secretData.username)
            println "Username: ${username}"
            return username
        } else {
            return "Error running kubectl command"
        }
    } catch (Exception e) {
        return "${e.message}"
    }
}



pipeline {
    agent any

    stages {
        stage('Check') {
            steps {
                script {
                    echo "Selected username"
                }
            }
        }
    }
}
